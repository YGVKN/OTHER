image: docker:19.03.15
services:
  - docker:19.03.15-dind

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_HOST: tcp://docker:2376
  GIT_DEPTH: 10
  #GIT_CLONE_PATH: $CI_BUILDS_DIR/$CI_CONCURRENT_ID/$CI_PROJECT_NAME
  #Look at ERROR: Job failed: prepare AbstractExecutor: setting GIT_CLONE_PATH is not
  #allowed, enable `custom_build_dir` feature ...


  #Recommend
  #docker pull ... || true
  #docker build --rm --cache-from


include: '.gitlab-ci/templates/.qa-template.yml'


stages:
  - QA


QA:
  stage: QA
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  extends: .qa-template
  when: manual
  allow_failure: true
  after_script:
    - echo "TODO ..."
  environment:
    name: dev
  only:
    - /^release.+$/
  tags:
    - qa

